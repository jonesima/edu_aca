<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Teacher Dashboard - EduSphere</title>

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- AOS + Feather -->
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet"/>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>

  <style>
    body { font-family: Inter, system-ui, -apple-system, "Helvetica Neue", Arial; }
    .sidebar { width: 250px; transition: all .25s ease; }
    .main-content { margin-left: 250px; transition: all .25s ease; }
    @media (max-width: 768px) {
      .sidebar { transform: translateX(-100%); position: fixed; z-index: 40; height: 100vh; }
      .sidebar.open { transform: translateX(0); }
      .main-content { margin-left: 0; }
    }
  </style>
</head>
<body class="bg-gray-100">

  <!-- Hidden logo/signature placeholders (optional) -->
  <!-- If you want to use a fixed URL instead of profile.logo_url, set schoolLogoUrl in teacher.js -->
  <img id="school-logo" src="" alt="school logo" class="hidden">
  <img id="principal-signature" src="" alt="principal signature" class="hidden">

  <!-- Sidebar -->
  <aside class="sidebar bg-gray-900 text-white fixed inset-y-0 left-0 z-50">
    <div class="flex items-center justify-between h-16 px-4 bg-gray-800">
      <div class="flex items-center">
        <i data-feather="book-open" class="h-8 w-8 text-indigo-400"></i>
        <span class="ml-2 text-xl font-bold">EduSphere</span>
      </div>
      <button class="md:hidden" onclick="toggleSidebar()">
        <i data-feather="x" class="h-6 w-6"></i>
      </button>
    </div>

    <nav class="mt-8 px-4 space-y-2">
      <div class="px-4 py-2 text-xs font-semibold text-gray-400 uppercase">Teaching</div>

      <a href="#" onclick="showSection(event,'dashboard-section')" class="nav-link flex items-center px-4 py-3 rounded-lg bg-indigo-700 text-white">
        <i data-feather="home" class="h-5 w-5"></i><span class="ml-3">Dashboard</span>
      </a>

      <a href="#" onclick="showSection(event,'classes-section')" class="nav-link flex items-center px-4 py-3 rounded-lg text-gray-300 hover:bg-gray-800">
        <i data-feather="book" class="h-5 w-5"></i><span class="ml-3">My Classes</span>
      </a>

      <a href="#" onclick="showSection(event,'students-section')" class="nav-link flex items-center px-4 py-3 rounded-lg text-gray-300 hover:bg-gray-800">
        <i data-feather="users" class="h-5 w-5"></i><span class="ml-3">Students</span>
      </a>

      <a href="#" onclick="showSection(event,'grading-section')" class="nav-link flex items-center px-4 py-3 rounded-lg text-gray-300 hover:bg-gray-800">
        <i data-feather="edit" class="h-5 w-5"></i><span class="ml-3">Grading</span>
      </a>

      <div class="px-4 py-2 mt-4 text-xs font-semibold text-gray-400 uppercase">Resources</div>

      <a href="#" onclick="showSection(event,'reports-section')" class="nav-link flex items-center px-4 py-3 rounded-lg text-gray-300 hover:bg-gray-800">
        <i data-feather="bar-chart-2" class="h-5 w-5"></i><span class="ml-3">Reports</span>
      </a>

      <a href="#" onclick="showSection(event,'deadlines-section')" class="nav-link flex items-center px-4 py-3 rounded-lg text-gray-300 hover:bg-gray-800">
        <i data-feather="calendar" class="h-5 w-5"></i><span class="ml-3">Deadlines</span>
      </a>

      <a href="#" onclick="showSection(event,'announcements-section')" class="nav-link flex items-center px-4 py-3 rounded-lg text-gray-300 hover:bg-gray-800">
        <i data-feather="bell" class="h-5 w-5"></i><span class="ml-3">Announcements</span>
      </a>
    </nav>
  </aside>

  <!-- Main content -->
  <div class="main-content">
    <header class="bg-white shadow">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16 items-center">
          <div class="flex items-center">
            <button class="md:hidden" onclick="toggleSidebar()">
              <i data-feather="menu" class="h-6 w-6 text-gray-500"></i>
            </button>
            <h1 class="ml-2 md:ml-0 text-2xl font-bold text-gray-900">Teacher Dashboard</h1>
          </div>

          <div class="flex items-center space-x-4">
            <select id="class-dropdown" class="pl-3 pr-10 py-2 border border-gray-300 rounded-lg"></select>
            <img class="h-8 w-8 rounded-full" src="http://static.photos/people/200x200/2" alt="profile"/>
            <span class="teacher-name text-sm font-medium text-gray-700">Loading...</span>
          </div>
        </div>
      </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8">

      <!-- Dashboard -->
      <section id="dashboard-section">
        <div class="bg-white rounded-lg shadow p-6">
          <h2 class="text-xl font-semibold mb-2">Welcome</h2>
          <p class="text-gray-600">Overview and quick actions.</p>
        </div>
      </section>

      <!-- Classes -->
      <section id="classes-section" class="hidden">
        <div class="bg-white rounded-lg shadow p-6">
          <h2 class="text-xl font-semibold mb-4">My Classes</h2>
          <div id="classes-list"></div>
        </div>
      </section>

      <!-- Students -->
      <section id="students-section" class="hidden">
        <div class="bg-white rounded-lg shadow p-6">
          <h2 class="text-xl font-semibold mb-4">Students</h2>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-4 py-2 text-left">Student</th>
                  <th class="px-4 py-2 text-left">Attendance</th>
                  <th class="px-4 py-2 text-left">Assignment Score</th>
                </tr>
              </thead>
              <tbody id="students-table" class="bg-white divide-y divide-gray-200"></tbody>
            </table>
          </div>
          <div class="mt-4 flex justify-end">
            <button id="save-changes" class="px-4 py-2 bg-indigo-600 text-white rounded-md">Save Changes</button>
          </div>
        </div>
      </section>

      <!-- Grading (placeholder area we can extend) -->
      <section id="grading-section" class="hidden">
        <div class="bg-white rounded-lg shadow p-6">
          <h2 class="text-xl font-semibold mb-4">Grading</h2>
          <p class="text-gray-600">Use the Students tab to enter grades quickly.</p>
        </div>
      </section>

      <!-- Reports -->
      <section id="reports-section" class="hidden">
        <div class="bg-white rounded-lg shadow p-6">
          <h2 class="text-xl font-semibold mb-4">Reports</h2>
          <div class="flex flex-wrap items-center space-x-2 mb-4">
            <select id="report-filter" class="px-2 py-1 border rounded-md text-sm">
              <option value="all">All Students</option>
              <option value="absent">Only Absentees</option>
              <option value="below50">Below 50%</option>
            </select>

            <select id="report-data-type" class="px-2 py-1 border rounded-md text-sm">
              <option value="both">Attendance + Grades</option>
              <option value="attendance">Attendance Only</option>
              <option value="grades">Grades Only</option>
            </select>

            <input type="date" id="report-start" class="px-2 py-1 border rounded-md text-sm"/>
            <input type="date" id="report-end" class="px-2 py-1 border rounded-md text-sm"/>

            <button id="generate-report" class="px-4 py-2 bg-indigo-600 text-white rounded-md">Generate Report</button>
          </div>
        </div>
      </section>

      <!-- Deadlines / Assignments -->
      <section id="deadlines-section" class="hidden">
        <div class="bg-white rounded-lg shadow p-6">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold">Upcoming Deadlines</h2>
            <div class="space-x-2">
              <button id="export-pdf-btn" class="px-3 py-1 text-sm rounded-md text-white bg-red-600">⬇ Export PDF</button>
              <button id="export-csv-btn" class="px-3 py-1 text-sm rounded-md text-white bg-gray-600">⬇ Export CSV</button>
              <button id="new-assignment-btn" class="px-3 py-1 text-sm rounded-md text-white bg-indigo-600">+ New</button>
            </div>
          </div>

          <!-- Summary & Progress -->
          <div id="deadlines-summary" class="mb-2 text-sm font-medium text-gray-700 space-x-3"></div>
          <div class="w-full bg-gray-200 rounded-full h-3 mb-4 cursor-pointer">
            <div id="deadlines-progress" class="bg-green-500 h-3 rounded-full" style="width:0%"></div>
          </div>

          <!-- Filters -->
          <div class="flex items-center space-x-4 mb-4">
            <input id="assignment-search" type="text" placeholder="Search assignments..." class="px-3 py-2 border rounded-md text-sm w-1/3" />
            <select id="class-filter" class="px-3 py-2 border rounded-md text-sm">
              <option value="all">All Classes</option>
            </select>
          </div>

          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-4 py-2 text-left">Assignment</th>
                  <th class="px-4 py-2 text-left">Class</th>
                  <th class="px-4 py-2 text-left">Due Date</th>
                  <th class="px-4 py-2 text-left">Status</th>
                  <th class="px-4 py-2 text-left">Actions</th>
                </tr>
              </thead>
              <tbody id="deadlines-table" class="divide-y divide-gray-200"></tbody>
            </table>
          </div>

          <!-- Assignment form -->
          <div id="assignment-form" class="hidden mt-4 border-t pt-4">
            <input id="assignment-title" type="text" placeholder="Assignment Title" class="w-full mb-2 px-3 py-2 border rounded-md text-sm" />
            <input id="assignment-due" type="date" class="w-full mb-2 px-3 py-2 border rounded-md text-sm" />
            <div class="flex justify-end">
              <button id="save-assignment" class="px-4 py-2 text-sm rounded-md text-white bg-indigo-600">Create Assignment</button>
            </div>
          </div>

        </div>
      </section>

      <!-- Announcements -->
      <section id="announcements-section" class="hidden">
        <div class="bg-white rounded-lg shadow p-6">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold">Announcements</h2>
            <button id="new-announcement-btn" class="px-4 py-2 bg-indigo-600 text-white rounded-md">+ New Announcement</button>
          </div>

          <div id="announcements-list" class="space-y-4 mb-4"></div>

          <div id="announcement-form" class="hidden">
            <input id="announcement-title" type="text" placeholder="Title" class="w-full mb-2 px-3 py-2 border rounded-md text-sm" />
            <textarea id="announcement-message" placeholder="Message" class="w-full mb-2 px-3 py-2 border rounded-md text-sm"></textarea>
            <div class="flex justify-end">
              <button id="save-announcement" class="px-4 py-2 bg-indigo-600 text-white rounded-md">Post</button>
            </div>
          </div>

        </div>
      </section>

    </main>
  </div>

  <!-- Report Preview Modal -->
  <div id="report-modal" class="fixed inset-0 bg-black bg-opacity-40 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-lg w-11/12 md:w-3/4 lg:w-2/3 max-h-[80vh] overflow-y-auto">
      <div class="flex justify-between items-center p-4 border-b">
        <h3 class="text-lg font-semibold">Report Preview</h3>
        <button id="close-report-modal">✕</button>
      </div>
      <div id="report-preview-content" class="p-4"></div>
      <div class="flex justify-end space-x-2 p-4 border-t">
        <button id="download-csv" class="px-4 py-2 bg-indigo-600 text-white rounded-md">Download CSV</button>
        <button id="download-pdf" class="px-4 py-2 bg-green-600 text-white rounded-md">Download PDF</button>
        <button id="print-report" class="px-4 py-2 bg-gray-700 text-white rounded-md">Print</button>
      </div>
    </div>
  </div>

  <!-- Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

  <!-- Supabase client and teacher script -->
  <script type="module" src="/supabase-client.js"></script>
  <script type="module" src="teacher.js"></script>

  <!-- small helpers -->
  <script>
    function toggleSidebar() {
      document.querySelector('.sidebar')?.classList.toggle('open');
    }
    function showSection(evt, sectionId) {
      document.querySelectorAll("main section").forEach(sec => sec.classList.add("hidden"));
      document.getElementById(sectionId).classList.remove("hidden");
      document.querySelectorAll(".nav-link").forEach(link => link.classList.remove("bg-indigo-700","text-white"));
      if (evt && evt.currentTarget) evt.currentTarget.classList.add("bg-indigo-700","text-white");
      // close mobile sidebar
      document.querySelector('.sidebar')?.classList.remove('open');
    }
    document.addEventListener('DOMContentLoaded', () => {
      feather.replace();
      // show dashboard by default
      showSection(null, 'dashboard-section');
    });
  </script>
</body>
</html>
